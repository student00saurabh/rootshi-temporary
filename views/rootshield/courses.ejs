<% layout("/layouts/boilerplate") -%>


<!-- Hero Section -->
<div class="bg-gradient-to-r from-cyan-600 to-indigo-700 text-white">
    <div class="container mx-auto px-4 py-16">
                <% if(currUser && currUser.role == "admin"){ %>
            <div class="flex justify-end">
    <a href="/courses/new"
       class="inline-flex items-center gap-2 px-5 py-3
              rounded-xl
              bg-gradient-to-r from-cyan-600 to-blue-600
              text-white font-semibold
              shadow-lg hover:shadow-xl
              hover:from-cyan-700 hover:to-blue-700
              transition-all duration-300
              focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2">

        <!-- Plus Icon -->
        <svg xmlns="http://www.w3.org/2000/svg"
             class="w-5 h-5"
             fill="none"
             viewBox="0 0 24 24"
             stroke="currentColor">
            <path stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4v16m8-8H4"/>
        </svg>

        Add New Course
    </a>
</div>
<% } %>
        <div class="max-w-3xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-6">Explore Our Courses</h1>
            <p class="text-xl mb-8 text-blue-100">Master new skills with our expert-led courses. Whether you're starting out or leveling up, we have the right path for you.</p>
            
            <!-- Search Bar -->
            <div class="max-w-2xl mx-auto">
                <form action="/courses" method="GET" class="flex">
                    <input 
                        type="text" 
                        name="search" 
                        value="<%= search %>" 
                        placeholder="Search courses, topics, or instructors..."
                        class="flex-grow px-4 py-2 rounded-l-xl text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                    <button 
                        type="submit" 
                        class="bg-white text-blue-600 px-4 py-2 rounded-r-xl font-semibold hover:bg-gray-100 transition-colors"
                    >
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<% if (cources.length === 0) { %>
    <!-- Empty State -->
    <div class="flex flex-col items-center justify-center py-24 text-center">
        <div class="w-24 h-24 mb-6 rounded-full bg-gradient-to-r from-cyan-500 to-blue-600 flex items-center justify-center text-white shadow-lg">
            <i class="fas fa-search text-3xl"></i>
        </div>

        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
            No Courses Found
        </h2>

        <p class="text-gray-600 dark:text-gray-400 max-w-md mb-6">
            We couldn’t find any courses matching 
            <span class="font-semibold text-cyan-600 dark:text-cyan-400">
                "<%= search || 'your search' %>"
            </span>.  
            Try searching with different keywords or explore all available courses.
        </p>

        <div class="flex gap-4">
            <a href="/courses"
               class="px-6 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-semibold hover:opacity-90 transition">
                View All Courses
            </a>

            <a href="/"
               class="px-6 py-3 rounded-xl border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                Go Home
            </a>
        </div>
    </div>
<% } else { %>

<!-- Main Content -->
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
     <!-- Featured Courses Section -->
    <section class="py-10 bg-white dark:bg-gray-900/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

            <!-- Courses Grid -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">

             <% cources.forEach(course => { %>
                <div class="group bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700 hover:border-cyan-500/30 transition-all duration-300 hover:shadow-2xl hover:-translate-y-2">
                    <div class="mb-4 relative overflow-hidden rounded-xl">
                        <div class="relative aspect-video bg-gradient-to-r from-blue-600/20 to-cyan-500/20 rounded-xl overflow-hidden">
                            <img
                                src="<%= course.image.url %>"
                                alt="<%= course.title %>"
                                class="absolute inset-0 w-full h-full object-cover"
                            />
                        </div>
                        <div class="absolute top-4 left-4">
                            <span class="px-3 py-1 bg-cyan-500 text-cyan-600 dark:text-cyan-900 text-xs font-semibold rounded-full">
                                <%= course.courceType %>
                            </span>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-cyan-600 dark:group-hover:text-cyan-300 transition-colors">
                        <%= course.title.length > 45 ? course.title.slice(0,45) + "..." : course.title %>
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">
                        <%= course.shortDescription.length > 120? course.shortDescription.slice(0,120) + "...": course.shortDescription %>
                    </p>
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center text-white">
                                <span class="text-sm font-bold"><%= (course.teacher.name || course.teacher.username || 'S').charAt(0).toUpperCase() %></span>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-900 dark:text-white"><%= course.teacher.name %></p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Security Architect</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-cyan-600 dark:text-cyan-300 font-bold text-lg">₹ <%= course.actualPrice %></div>
                            <div class="text-gray-500 dark:text-gray-500 text-sm line-through">₹ <%= course.price %></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                        <div class="flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <%= course.duration %> Hours
                        </div>
                        <div class="flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                            1,245 Students
                        </div>
                    </div>
                    <div class="flex w-full rounded-xl overflow-hidden">
    
    <!-- Left Side -->
    <a href="/courses/<%= course._id %>" 
       class="w-1/2 text-center py-3 
              bg-gradient-to-r from-cyan-500 to-blue-600
              text-cyan-200 dark:text-cyan-300 
              font-semibold
              hover:bg-cyan-50 dark:hover:bg-gray-700
              transition">
        View Details
    </a>

    <!-- Right Side -->
    <button
        onclick="openEnrollModal('<%= course._id %>', '<%= course.actualPrice %>', '<%= course.title %>')"
        class="w-1/2 py-3 
               bg-gradient-to-r from-cyan-500 to-blue-600
               text-white font-semibold
               hover:from-cyan-600 hover:to-blue-700
               transition">
        Enroll Now
    </button>

</div>

<% if(currUser && currUser.role == "admin"){ %>
<div class="flex py-2 flex-wrap gap-2">

    <!-- Edit (GET) -->
    <a href="/courses/<%= course._id %>/edit"
       class="px-3 py-1.5 rounded-lg text-sm
              bg-blue-600 text-white
              hover:bg-blue-700 transition">
        Edit
    </a>

    <!-- Toggle Active (PATCH) -->
    <form method="POST" action="/courses/<%= course._id %>/?_method=PATCH">
        <button
            type="submit"
            class="px-3 py-1.5 rounded-lg text-sm
            <%= course.isActive ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700' %>
            text-white transition">
            <%= course.isActive ? 'Deactivate' : 'Activate' %>
        </button>
    </form>

    <!-- Toggle Popular (PATCH) -->
    <form method="POST" action="/courses/<%= course._id %>/popular?_method=PATCH">
        <button
            type="submit"
            class="px-3 py-1.5 rounded-lg text-sm
            <%= course.isPopular ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-cyan-600 hover:bg-yellow-700 shadow-lg' %>
            text-white transition">
            <%= course.isPopular ? 'Popular ✓' : 'Make Popular' %>
        </button>
    </form>

    <!-- Delete (DELETE) -->
    <form method="POST"
          action="/courses/<%= course._id %>?_method=DELETE"
          onsubmit="return confirm('Are you sure you want to delete this course?')">
        <button
            type="submit"
            class="px-3 py-1.5 rounded-lg text-sm
                   bg-red-600 text-white hover:bg-red-700 transition">
            Delete
        </button>
    </form>

</div>
 <% } %>


                </div>
            <% }) %>
            </div>   

            <!-- pagination -->
             <div class="flex justify-center mt-10 gap-2">
  <% if (currentPage > 1) { %>
    <a href="?page=<%= currentPage - 1 %>&search=<%= search %>"
       class="px-4 py-2 border rounded-lg">
      Prev
    </a>
  <% } %>

  <% for (let i = 1; i <= totalPages; i++) { %>
    <a href="?page=<%= i %>&search=<%= search %>"
       class="px-4 py-2 rounded-lg 
       <%= i === currentPage ? 'bg-blue-600 text-white' : 'border' %>">
      <%= i %>
    </a>
  <% } %>

  <% if (currentPage < totalPages) { %>
    <a href="?page=<%= currentPage + 1 %>&search=<%= search %>"
       class="px-4 py-2 border rounded-lg">
      Next
    </a>
  <% } %>
</div>
        </div>
    </section>
</div>


<div id="enrollModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
  <div class="bg-white dark:bg-gray-900 rounded-2xl w-full max-w-lg p-6 relative">

    <!-- Close -->
    <button onclick="closeEnrollModal()" class="absolute top-3 right-3 text-gray-500">✕</button>

    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
      Enroll in Course
    </h2>

    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
  You can either fill out the form to enroll in this course,  
  or contact us via WhatsApp or the contact page for enrollment assistance.  
  If you have any doubts or questions, feel free to reach out to us.
</p>

    <!-- FORM -->
    <form method="POST" action="/enroll" class="space-y-4">

      <input type="hidden" name="courseId" id="courseId">
      <input type="hidden" name="paidPrice" id="paidPrice">

      <!-- Name -->
      <input
        type="text"
        name="name"
        value="<%= currUser ? currUser.name : '' %>"
        required
        placeholder="Your Name"
        class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 dark:text-white"
      />

      <!-- Email -->
      <input
        type="email"
        name="email"
        value="<%= currUser ? currUser.email : '' %>"
        required
        placeholder="Email Address"
        class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 dark:text-white"
      />

      <!-- Mobile -->
      <input
        type="tel"
        name="mobile"
        value="<%= currUser && currUser.mobile ? currUser.mobile : '' %>"
        required
        placeholder="Mobile Number"
        class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 dark:text-white"
      />

      <!-- Description -->
      <textarea
        name="description"
        placeholder="Any doubt or message (optional)"
        class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 dark:text-white"
      ></textarea>

      <!-- Submit -->
      <button
        type="submit"
        class="w-full py-3 rounded-xl bg-cyan-600 hover:bg-cyan-700 text-white font-semibold">
        Enroll Now
      </button>
    </form>

    <!-- CONTACT OPTIONS -->
    <div class="mt-4 flex justify-between text-sm">
      <a
        href="https://wa.me/91XXXXXXXXXX"
        target="_blank"
        class="text-green-600 font-semibold"
      >
        WhatsApp
      </a>

      <a
        href="/contact"
        class="text-cyan-600 font-semibold"
      >
        Contact Us
      </a>
    </div>

  </div>
</div>


<script>
  function openEnrollModal(courseId, price) {
    document.getElementById("courseId").value = courseId;
    document.getElementById("paidPrice").value = price;
    document.getElementById("enrollModal").classList.remove("hidden");
    document.getElementById("enrollModal").classList.add("flex");
  }

  function closeEnrollModal() {
    document.getElementById("enrollModal").classList.add("hidden");
  }
</script>

<% } %>
